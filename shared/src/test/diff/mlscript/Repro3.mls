:NoJS


// TODO use RecType immediately for all TVs in canon?


:stdout
:s
:d
:ds
def f: { x: 'a } as 'a


// :stdout
// :s
// :d
// :ds
rec def l a = l
//│ l: anything -> 'a as 'a


// TODO-simplif
// :ds
fun a -> a a
//│ res: (('a & 'c,) as 'b) -> 'd as 'a


// :stdout
// :s
// :d
// :ds
:e
rec def f a = a a
//│ (('a & 'c,) as 'b) -> 'd as 'a
//│   <:  f:
//│ {x: 'a} as 'a
//│ ╔══[ERROR] Type mismatch in def definition:
//│ ║  l.33: 	rec def f a = a a
//│ ║        	^^^^^^^^^^^^^^^^^
//│ ╟── function of type `?b -> ?c` does not match type `{x: ?a} | 'a`
//│ ║  l.33: 	rec def f a = a a
//│ ║        	          ^^^^^^^
//│ ╟── Note: constraint arises from local type binding:
//│ ║  l.11: 	def f: { x: 'a } as 'a
//│ ╙──      	       ^^^^^^^^^

// :stdout
// :s
// :d
// :ds
rec def g a = a a
//│ g: (('a & 'c,) as 'b) -> 'd as 'a



class Some[A]: { v: A }
//│ Defined class Some

// :ds
def Some v = Some{v}
//│ Some: ('v & 'A) -> (Some['A] with {v: 'v})

